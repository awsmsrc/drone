<html>
  <head>
    <script>
      var arDrone = require('ar-drone');
      var dronestream = require('dronestream');
      var client  = arDrone.createClient();
      var updateSpeed = 500;
      var directions = {
          forward: false,
          backward: false,
          up: false,
          down: false,
          left: false,
          right: false,
          flip: false
      };
      
      client.takeoff();

      window.onkeydown = function(e){
        if (e.keyCode == '38') directions.forward = true;
        if (e.keyCode == '40') directions.backward = true;
        if (e.keyCode == '37') directions.left = true;
        if (e.keyCode == '39') directions.right = true;
        if (e.keyCode == '87') directions.up = true;
        if (e.keyCode == '83') directions.down = true;
        if (e.keyCode == '32') directions.flip = true;
      }
      
      window.onkeyup = function(e){
        if (e.keyCode == '38') directions.forward = false;
        if (e.keyCode == '40') directions.backward = false;
        if (e.keyCode == '37') directions.left = false;
        if (e.keyCode == '39') directions.right = false;
        if (e.keyCode == '87') directions.up = false;
        if (e.keyCode == '83') directions.down = false;
        if (e.keyCode == '32') directions.flip = false;
      }

      var server = require('http').createServer()
      server.listen(5555)
      dronestream.listen(server)


      setInterval(function(){
          var s = updateSpeed/100;
          
          if (directions.flip) return client.animate('flipLeft', 400);
          
          if (directions.forward) client.front(s);
          if (directions.backward) client.back(s);
          if (directions.up) client.up(s);
          if (directions.down) client.down(s);
          if (directions.left) client.counterClockwise(s);
          if (directions.right) client.clockwise(s);
      }, updateSpeed);
      
    </script>
    <script src="./node_modules/dronestream/dist/nodecopter-client.js"></script>
  </head>
  <body>
    <h1>Fly</h1> 
    <div id="droneStream" style="width: 640px; height: 360px">   </div> 
    <script type="text/javascript" charset="utf-8">
      new NodecopterStream(document.getElementById("droneStream"), {
        hostname:'localhost', port:5555
      });
    </script>
  </body>
</html>
